<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday — Miss S!</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --cake:#f6c9a9;
      --cake-layer:#e6aa82;
      --icing:#fff5f6;
      --plate:#e9eef6;
      --candle:#ffd166;
      --flame1:#ffd54a;
      --flame2:#ff6b6b;
      --text:#f8fafc;
      --accent:#ff7ab6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255,122,186,0.06), transparent),
                  linear-gradient(180deg,#071024 0%, var(--bg) 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px;
    }

    .stage{
      width:100%;
      max-width:920px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:20px;
      padding:36px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      position:relative;
      overflow:hidden;
    }

    header{
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:18px;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),#7c6bff);
      display:flex;align-items:center;justify-content:center;font-weight:700;
      color:white; font-size:20px;
      box-shadow:0 6px 18px rgba(124,107,255,0.16);
    }
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:rgba(255,255,255,0.75);font-size:14px}

    .scene{
      display:flex;
      gap:36px;
      align-items:center;
      justify-content:space-between;
      padding:20px 6px;
      flex-wrap:wrap;
    }

    /* cake area */
    .cake-wrap{
      flex:1 1 360px;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      -webkit-user-select:none;
    }

    .cake{
      width:360px;
      height:260px;
      position:relative;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      transform-origin:center;
      transition:transform .35s ease;
    }

    /* plate */
    .plate{
      position:absolute;
      bottom:-8px;
      width:420px;
      height:56px;
      border-radius:60px;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(0,0,0,0.06));
      opacity:0.95;
      display:block;
      left:50%;
      transform:translateX(-50%);
      box-shadow: 0 8px 20px rgba(2,6,23,0.45);
      z-index:0;
    }

    /* cake body: two layers */
    .layer{
      border-radius:18px;
      width:320px;
      height:120px;
      background:linear-gradient(180deg,var(--cake),var(--cake-layer));
      box-shadow: inset 0 4px 0 rgba(255,255,255,0.18), 0 8px 20px rgba(2,6,23,0.35);
      position:relative;
      z-index:2;
      display:flex;
      align-items:center;
      justify-content:center;
      padding-top:38px;
    }

    .icing{
      position:absolute;
      top:0;
      left:50%;
      transform:translateX(-50%);
      width:88%;
      height:56px;
      background:var(--icing);
      border-radius:12px 12px 40px 40px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.12);
      z-index:3;
    }

    .candles{
      position:absolute;
      top:14px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:16px;
      z-index:6;
    }

    .candle{
      width:18px;
      height:64px;
      background:linear-gradient(180deg,var(--candle),#ffb85c);
      border-radius:6px;
      position:relative;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      cursor:pointer;
      transition:transform .18s ease;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2), inset 0 2px 0 rgba(255,255,255,0.35);
    }

    .candle:active{ transform:translateY(2px); }

    .wick{
      width:2px;height:6px;background:#3b302f;border-radius:2px;
      position:absolute;top:-6px;left:50%;transform:translateX(-50%);
      z-index:8;
    }

    /* flame built by pseudo elements */
    .flame{
      position:absolute;
      top:-20px;
      left:50%;
      transform:translateX(-50%) scale(.95);
      width:18px;
      height:28px;
      pointer-events:auto;
      z-index:9;
      filter:drop-shadow(0 6px 8px rgba(255,120,160,0.18));
      transition:opacity .25s linear, transform .25s linear;
      transform-origin:50% 80%;
    }

    .flame .inner{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      width:12px;height:18px;border-radius:50% 50% 50% 50% / 60% 60% 40% 40%;
      background: radial-gradient(circle at 40% 30%, var(--flame2), var(--flame1));
      animation: flicker 160ms infinite;
      transform-origin:50% 80%;
      opacity:1;
    }

    .flame .outer{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      width:6px;height:10px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff6a8, rgba(255,255,255,0));
      opacity:.9;
      mix-blend-mode:screen;
      animation: softFlick 220ms infinite;
    }

    @keyframes flicker{
      0%{transform:translate(-50%,-50%) scale(1) rotate(0deg);opacity:1}
      50%{transform:translate(-50%,-54%) scale(1.06) rotate(-2deg);opacity:.92}
      100%{transform:translate(-50%,-50%) scale(.98) rotate(1deg);opacity:1}
    }
    @keyframes softFlick{
      0%{transform:translate(-50%,-50%) scale(1);opacity:.9}
      50%{transform:translate(-50%,-52%) scale(1.06);opacity:.75}
      100%{transform:translate(-50%,-50%) scale(1);opacity:.9}
    }

    /* extinguished state */
    .candle.out .flame{opacity:0; transform:translateX(-50%) scale(.6) translateY(6px)}
    .candle.out .inner, .candle.out .outer{animation:none}

    /* tiny smoke */
    .smoke{
      position:absolute;
      left:50%; top:-10px;
      transform:translateX(-50%);
      width:8px;height:18px;
      border-radius:20px;
      opacity:0;
      pointer-events:none;
    }
    .smoke span{
      position:absolute;left:50%;transform:translateX(-50%);width:8px;height:8px;border-radius:50%;
      background:linear-gradient(180deg, rgba(200,200,200,0.35), rgba(150,150,150,0.08));
      filter:blur(2px);
      animation:smokeUp 1600ms forwards;
    }
    @keyframes smokeUp{
      0%{transform: translate(-50%,0) scale(.8); opacity:1}
      100%{transform: translate(-50%,-40px) scale(1.6); opacity:0}
    }

    /* confetti */
    .confetti{
      position:absolute; inset:0; pointer-events:none; z-index:40;
    }
    .confetti .piece{
      position:absolute; width:10px;height:14px; border-radius:2px;
      opacity:0; transform:translateY(-20px) rotate(0deg);
    }

    /* right column - message and controls */
    .panel{
      width:320px;
      flex:0 0 320px;
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:flex-start;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:18px;
      border-radius:12px;
      width:100%;
      box-shadow: 0 8px 28px rgba(2,6,23,0.45);
    }
    .big-msg{font-size:18px;margin:0 0 8px 0}
    .sub{font-size:14px;color:rgba(255,255,255,0.8);margin:0}

    .controls{
      display:flex;gap:10px;margin-top:6px;flex-wrap:wrap;
    }

    button{
      border:0;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#7c6bff);
      color:white;font-weight:600;cursor:pointer;box-shadow:0 8px 22px rgba(124,107,255,0.12);
    }
    .muted{
      background:transparent;border:1px solid rgba(255,255,255,0.06);color:rgba(255,255,255,0.9)
    }

    .hint{font-size:13px;color:rgba(255,255,255,0.6)}

    /* overlay when completed */
    .overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(10,12,20,0.4), rgba(3,7,16,0.6));
      z-index:60; border-radius:20px; opacity:0; pointer-events:none;
      transition:opacity .36s ease;
      flex-direction:column; gap:14px; padding:28px;
    }
    .overlay.show{opacity:1; pointer-events:auto}

    .wish{
      font-size:22px;font-weight:700;color:var(--text);
      text-align:center;
    }
    .next-btn{
      padding:12px 18px;border-radius:12px;background:linear-gradient(90deg,#ff8ab0,#7c6bff);
      color:white;font-weight:700;border:0;cursor:pointer;
      box-shadow: 0 10px 28px rgba(124,107,255,0.18);
    }

    /* small responsive */
    @media (max-width:820px){
      .scene{flex-direction:column;align-items:center}
      .panel{width:100%;flex:unset}
      .cake{width:300px;height:210px}
      .plate{width:360px}
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <header>
      <div class="logo">S</div>
      <div>
        <h1>Happy Birthday, Miss S!</h1>
        <p class="lead">Make a wish — tap the flame or gently swipe the cake to continue.</p>
      </div>
    </header>

    <div class="scene">
      <div class="cake-wrap" id="cakeWrap" aria-hidden="false">
        <div class="cake" id="cake">
          <div class="plate" aria-hidden="true"></div>

          <div class="layer" aria-hidden="true">
            <div class="icing"></div>
            <div style="position:relative;z-index:4;text-align:center;padding:6px 30px;">
              <div style="font-weight:700;color:#6b2b2b;letter-spacing:0.2px;">Miss S</div>
              <div style="font-size:12px;color:rgba(0,0,0,0.45);margin-top:6px;">Make your wish</div>
            </div>
          </div>

          <div class="candles" id="candles">
            <!-- we create 3 candles -->
            <div class="candle" data-index="0" role="button" tabindex="0" aria-label="Candle 1">
              <div class="wick"></div>
              <div class="flame" aria-hidden="false">
                <div class="inner"></div>
                <div class="outer"></div>
              </div>
            </div>

            <div class="candle" data-index="1" role="button" tabindex="0" aria-label="Candle 2">
              <div class="wick"></div>
              <div class="flame">
                <div class="inner"></div>
                <div class="outer"></div>
              </div>
            </div>

            <div class="candle" data-index="2" role="button" tabindex="0" aria-label="Candle 3">
              <div class="wick"></div>
              <div class="flame">
                <div class="inner"></div>
                <div class="outer"></div>
              </div>
            </div>
          </div>

          <div class="smoke" id="smoke"></div>
        </div>

        <div class="confetti" id="confetti"></div>
      </div>

      <aside class="panel">
        <div class="card">
          <div class="big-msg">🎂 Birthday Cake</div>
          <p class="sub">It's Miss S's special day. Tap the flame, press "Blow", or swipe across the cake to blow out the candles.</p>

          <div class="controls" style="margin-top:12px;">
            <button id="blowBtn">Blow 🎉</button>
            <button id="swipeHint" class="muted">How to swipe</button>
            <button id="reset" class="muted">Reset</button>
          </div>

          <p class="hint" style="margin-top:10px">Tip: on mobile, swipe left or right over the cake. On desktop you can click the flame or press the "Blow" button.</p>
        </div>

        <div class="card">
          <div style="font-weight:700">Wish Box</div>
          <p class="sub" style="margin-top:8px">Type a short wish (optional). It will show on the next page with the letter.</p>
          <input id="wishInput" placeholder="Type your wish for Miss S..." style="width:100%;margin-top:8px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)" />
        </div>
      </aside>
    </div>

    <div class="overlay" id="overlay" aria-hidden="true">
      <div class="wish" id="wishText">Make a wish... ✨</div>
      <button class="next-btn" id="nextBtn">Open your letter</button>
    </div>
  </div>

  <script>
    // Elements
    const candles = document.querySelectorAll('.candle');
    const overlay = document.getElementById('overlay');
    const nextBtn = document.getElementById('nextBtn');
    const blowBtn = document.getElementById('blowBtn');
    const smoke = document.getElementById('smoke');
    const confettiRoot = document.getElementById('confetti');
    const wishInput = document.getElementById('wishInput');
    const cake = document.getElementById('cake');
    const cakeWrap = document.getElementById('cakeWrap');

    let extinguished = false;

    // Clicking / tapping flame
    candles.forEach(c => {
      c.addEventListener('click', tryBlow);
      c.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') tryBlow(); })
    });

    // Blow button
    blowBtn.addEventListener('click', tryBlow);

    // Swipe detection
    let touchStartX = null, touchStartY = null;
    cakeWrap.addEventListener('touchstart', (e)=>{
      if(e.touches && e.touches[0]){
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    }, {passive:true});

    cakeWrap.addEventListener('touchend', (e)=>{
      if(touchStartX === null) return;
      const touch = e.changedTouches[0];
      const dx = touch.clientX - touchStartX;
      const dy = touch.clientY - touchStartY;
      if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)){
        // register swipe
        tryBlow();
      }
      touchStartX = null; touchStartY = null;
    });

    // Desktop: allow dragging with mouse to simulate swipe
    let mouseDown = false, mouseStartX = 0;
    cakeWrap.addEventListener('mousedown', e => { mouseDown = true; mouseStartX = e.clientX; });
    window.addEventListener('mouseup', e => {
      if(!mouseDown) return;
      const dx = e.clientX - mouseStartX;
      if(Math.abs(dx) > 80) tryBlow();
      mouseDown = false;
    });

    // Main blow routine - idempotent
    function tryBlow(){
      if(extinguished) return;
      extinguished = true;
      // add out class to candles (hide flames)
      candles.forEach(c => c.classList.add('out'));
      // smoke animation
      spawnSmoke();
      // confetti
      spawnConfetti();
      // show overlay with wish
      const wish = wishInput.value.trim();
      const wishTextEl = document.getElementById('wishText');
      wishTextEl.textContent = wish ? `"${wish}" — your wish is noted ✨` : 'Make a wish... ✨';
      overlay.classList.add('show');

      // small cake bounce
      cake.style.transform = 'translateY(-6px) scale(0.99)';
      setTimeout(()=> cake.style.transform = '', 360);
    }

    // Smoke spawner
    function spawnSmoke(){
      // create 4 smoke puffs
      for(let i=0;i<4;i++){
        const s = document.createElement('span');
        s.style.left = (50 + (Math.random()*28-14)) + '%';
        s.style.animationDelay = (i*120) + 'ms';
        smoke.appendChild(s);
        // remove after animation
        setTimeout(()=> s.remove(), 1600 + i*200);
      }
      // briefly make visible
      smoke.style.opacity = 1;
      setTimeout(()=> smoke.style.opacity = 0, 1800);
    }

    // Confetti generator
    function spawnConfetti(){
      const colors = ['#ff6b6b','#ffd54a','#6bffb0','#7c6bff','#ff8ab0'];
      const container = confettiRoot;
      // create many pieces
      for(let i=0;i<30;i++){
        const p = document.createElement('div');
        p.className = 'piece';
        const w = 8 + Math.random()*10;
        p.style.width = w + 'px';
        p.style.height = (10 + Math.random()*12) + 'px';
        p.style.left = ((Math.random()*80)+10) + '%';
        p.style.top = (10 + Math.random()*30) + '%';
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.opacity = 0;
        p.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
        container.appendChild(p);

        // animate via JS
        const delay = Math.random()*300;
        setTimeout(()=>{
          p.style.transition = `transform 1200ms cubic-bezier(.2,.9,.2,1), opacity 800ms ease`;
          const tx = (Math.random()*200 - 100);
          const ty = 220 + Math.random()*60;
          const rot = Math.random()*720;
          p.style.transform = `translate(${tx}px, ${ty}px) rotate(${rot}deg)`;
          p.style.opacity = 1;
        }, delay);

        // fade out and remove
        setTimeout(()=> {
          p.style.transition = 'opacity 800ms ease';
          p.style.opacity = 0;
        }, 1800 + Math.random()*400);

        setTimeout(()=> p.remove(), 2600 + Math.random()*500);
      }
    }

    // Next button - go to letter.html, pass wish via query param
    nextBtn.addEventListener('click', ()=> {
      const wish = encodeURIComponent(wishInput.value || '');
      // go to letter page; include wish param for personalization
      window.location.href = 'letter.html?wish=' + wish;
    });

    // Reset for demo/testing
    const resetBtn = document.getElementById('reset');
    resetBtn.addEventListener('click', ()=> {
      extinguished = false;
      candles.forEach(c => c.classList.remove('out'));
      overlay.classList.remove('show');
      confettiRoot.innerHTML = '';
      smoke.innerHTML = '';
      wishInput.value = '';
    });

    // Accessibility: allow keyboard blow via B key
    window.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'b') tryBlow();
    });

    // small entrance animation
    window.requestAnimationFrame(()=> {
      cake.style.transform = 'translateY(18px) scale(.98)';
      setTimeout(()=> cake.style.transform = '', 420);
    });

  </script>
</body>
</html>
